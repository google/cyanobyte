steps:
- name: docker.io/library/python:3.7
  args: ['pip3', 'install', '-r', 'requirements.txt', '--user']
  id: Install dependencies
- name: docker.io/library/python:3.7
  entrypoint: bash
  args: ['-c', 'python3 -m pylint --rcfile=test/pylintrc ./src/*.py']
  id: Lint source code
  waitFor: ['Install dependencies']
- name: docker.io/library/python:3.7
  entrypoint: bash
  args: ['-c', 'python3 -m pylint --rcfile=test/pylintrc ./test/sampleData/*.py']
  id: Lint autogenerated files
  waitFor: ['Install dependencies']
- name: docker.io/library/python:3.7
  entrypoint: python
  args: ['-m', 'unittest', 'test.test_codegen']
  id: Run unit tests
  waitFor: ['Lint source code', 'Lint autogenerated files']
- name: docker.io/library/python:3.7
  args: ['src/codegen.py -t templates/raspberrypi.py -o ./build -i peripherals/Mcp4725.yaml']
  id: Sample Python codegen
artifacts:
  objects:
    # Store generated files in a Cloud Storage bucket with the commit hash as directory
    location: 'gs://cyanobyte-235018-githubci/$SHORT_SHA'
    paths: ['build/com/cyanobyte/Mcp4725.py']
